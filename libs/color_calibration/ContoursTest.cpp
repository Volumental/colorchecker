#define BOOST_TEST_DYN_LINK
#include <vector>

#include <boost/test/unit_test.hpp>

#include <color_calibration/ColorCalibration.hpp>

BOOST_AUTO_TEST_SUITE(komb)
BOOST_AUTO_TEST_SUITE(color_calibration)

static const double kTestFloatPercentTolerance = 1E-3;

BOOST_AUTO_TEST_CASE(SimplifyContourTest1)
{
    // This contour is tricky because some points exists more than once.
    const std::vector<cv::Point> contour = {
        { 197, 115 },
        { 196, 116 },
        { 195, 116 },
        { 194, 116 },
        { 193, 116 },
        { 192, 116 },
        { 191, 117 },
        { 191, 118 },
        { 192, 118 },
        { 193, 118 },
        { 194, 119 },
        { 195, 119 },
        { 196, 120 },
        { 195, 121 },
        { 194, 122 },
        { 193, 122 },
        { 192, 122 },
        { 191, 122 },
        { 190, 122 },
        { 189, 123 },
        { 188, 123 },
        { 188, 124 },
        { 188, 125 },
        { 188, 126 },
        { 189, 127 },
        { 190, 128 },
        { 189, 129 },
        { 190, 130 },
        { 191, 130 },
        { 192, 130 },
        { 193, 129 },
        { 194, 129 },
        { 195, 130 },
        { 196, 130 },
        { 197, 130 },
        { 198, 130 },
        { 199, 130 },
        { 200, 130 },
        { 199, 129 },
        { 198, 129 },
        { 197, 129 },
        { 196, 128 },
        { 197, 127 },
        { 198, 126 },
        { 199, 125 },
        { 200, 124 },
        { 200, 123 },
        { 200, 122 },
        { 199, 122 },
        { 198, 122 },
        { 197, 122 },
        { 196, 122 },
        { 195, 121 },
        { 196, 120 },
        { 197, 120 },
        { 198, 119 },
        { 199, 119 },
        { 200, 119 },
        { 201, 118 },
        { 202, 117 },
        { 201, 116 },
        { 200, 116 },
        { 199, 116 },
        { 198, 116 },
    };
    cv::Mat3b empty_canvas;
    const std::vector<cv::Point2f> simple_contour = simplifyContour(contour, empty_canvas);
    BOOST_CHECK_GT(simple_contour.size(), 0);
}

BOOST_AUTO_TEST_CASE(SimplifyContourTest2)
{
    // This contour is tricky because some points exists more than once.
    const std::vector<cv::Point> contour = {
        { 261, 173 },
        { 261, 174 },
        { 261, 175 },
        { 262, 176 },
        { 262, 177 },
        { 263, 178 },
        { 264, 179 },
        { 265, 180 },
        { 265, 181 },
        { 266, 182 },
        { 266, 183 },
        { 267, 184 },
        { 268, 185 },
        { 269, 186 },
        { 269, 187 },
        { 269, 188 },
        { 269, 189 },
        { 268, 190 },
        { 267, 190 },
        { 266, 190 },
        { 265, 190 },
        { 264, 191 },
        { 263, 191 },
        { 262, 190 },
        { 262, 189 },
        { 261, 189 },
        { 260, 189 },
        { 259, 188 },
        { 258, 188 },
        { 257, 187 },
        { 257, 186 },
        { 256, 185 },
        { 255, 185 },
        { 254, 184 },
        { 253, 184 },
        { 252, 183 },
        { 251, 182 },
        { 250, 181 },
        { 250, 180 },
        { 249, 179 },
        { 248, 178 },
        { 248, 177 },
        { 248, 176 },
        { 248, 177 },
        { 248, 178 },
        { 248, 179 },
        { 248, 180 },
        { 249, 181 },
        { 250, 182 },
        { 251, 183 },
        { 252, 184 },
        { 252, 185 },
        { 253, 186 },
        { 254, 187 },
        { 255, 188 },
        { 256, 189 },
        { 257, 190 },
        { 258, 190 },
        { 259, 190 },
        { 260, 191 },
        { 261, 191 },
        { 262, 191 },
        { 263, 191 },
        { 264, 191 },
        { 265, 191 },
        { 266, 192 },
        { 267, 192 },
        { 268, 192 },
        { 269, 193 },
        { 270, 193 },
        { 271, 193 },
        { 272, 193 },
        { 271, 192 },
        { 270, 191 },
        { 269, 191 },
        { 268, 190 },
        { 269, 189 },
        { 270, 189 },
        { 269, 188 },
        { 269, 187 },
        { 269, 186 },
        { 270, 185 },
        { 270, 184 },
        { 269, 183 },
        { 269, 182 },
        { 268, 181 },
        { 267, 180 },
        { 266, 179 },
        { 265, 178 },
        { 264, 177 },
        { 263, 176 },
        { 262, 175 },
        { 262, 174 },
    };
    cv::Mat3b empty_canvas;
    const std::vector<cv::Point2f> simple_contour = simplifyContour(contour, empty_canvas);
    BOOST_CHECK_GT(simple_contour.size(), 0);
}

BOOST_AUTO_TEST_SUITE_END()
BOOST_AUTO_TEST_SUITE_END()
